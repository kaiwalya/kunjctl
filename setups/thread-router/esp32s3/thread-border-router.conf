# Thread Router for ESP Thread Border Router Board (S3 side)
# S3 runs OpenThread host stack, communicating with H2 RCP via UART

CONFIG_IDF_TARGET="esp32s3"

# Flash size (S3 on border router board has 8MB)
CONFIG_ESPTOOLPY_FLASHSIZE_8MB=y

# Console via USB (keep UART free for RCP communication)
CONFIG_ESP_CONSOLE_USB_SERIAL_JTAG=y

# FTD (Full Thread Device) - can be router/leader
CONFIG_OPENTHREAD_FTD=y

# S3 doesn't have 802.15.4 radio - disable native radio settings
CONFIG_IEEE802154_ENABLED=n
CONFIG_OPENTHREAD_RADIO_NATIVE=n

# Use UART to talk to RCP (H2 handles the radio)
CONFIG_OPENTHREAD_RADIO_SPINEL_UART=y

# Stack sizes (UART RCP mode needs more stack)
CONFIG_OPENTHREAD_TASK_SIZE=8192
CONFIG_ESP_MAIN_TASK_STACK_SIZE=6144

# Disable OpenThread console (avoid any UART interference)
CONFIG_OPENTHREAD_CONSOLE_ENABLE=n
CONFIG_OPENTHREAD_CLI=n

# Disable features not needed
CONFIG_OPENTHREAD_SRP_CLIENT=n
CONFIG_OPENTHREAD_DNS_CLIENT=n

# Logging
CONFIG_OPENTHREAD_LOG_LEVEL_DYNAMIC=n
CONFIG_OPENTHREAD_LOG_LEVEL_NOTE=y

# UART settings - no hardware flow control (matching karna)
CONFIG_UART_ISR_IN_IRAM=y

# mbedTLS for Thread security
CONFIG_MBEDTLS_CMAC_C=y
CONFIG_MBEDTLS_SSL_PROTO_DTLS=y
CONFIG_MBEDTLS_KEY_EXCHANGE_ECJPAKE=y
CONFIG_MBEDTLS_ECJPAKE_C=y
CONFIG_MBEDTLS_HKDF_C=y

# Matter via esp-matter (Docker build)
CONFIG_ESP_MATTER_ENABLED=y

# Matter over WiFi (not Thread) - we use Thread separately for end-device comms
CONFIG_ENABLE_WIFI_STATION=y
CONFIG_USE_MINIMAL_MDNS=y
CONFIG_ENABLE_MATTER_OVER_THREAD=n

# Custom partition table with 2MB app partition (Matter binary is ~1.7MB)
CONFIG_PARTITION_TABLE_CUSTOM=y
CONFIG_PARTITION_TABLE_CUSTOM_FILENAME="partitions-matter.csv"

# BLE for Matter commissioning
CONFIG_BT_ENABLED=y
CONFIG_BT_NIMBLE_ENABLED=y

# Stack sizes for Matter (override defaults)
CONFIG_ESP_MAIN_TASK_STACK_SIZE=8192
